(window.webpackJsonp=window.webpackJsonp||[]).push([[255],{754:function(t,s,v){"use strict";v.r(s);var n=v(17),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,v=t._self._c||s;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"什么是灰度发布"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#什么是灰度发布"}},[t._v("#")]),t._v(" 什么是灰度发布?")]),t._v(" "),v("p",[t._v("# 什么是灰度发布，以及灰度发布A/B测试")]),t._v(" "),v("p",[t._v("在一般情况下，升级服务器端应用，需要将应用源码或程序包上传到服务器，然后停止掉老版本服务，再启动新版本。但是这种简单的发布方式存在两个问题，一方面，在新版本升级过程中，服务是暂时中断的，另一方面，如果新版本有BUG，升级失败，回滚起来也非常麻烦，容易造成更长时间的服务不可用。")]),t._v(" "),v("p",[t._v("为了解决这些问题，人们研究出了多种发布策略，下面我们一一介绍。")]),t._v(" "),v("p",[t._v("## 蓝绿部署\n"),v("img",{attrs:{src:"https://img-blog.csdn.net/20180822160107866?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20zNzEwNDc2MjM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70",alt:"img"}})]),t._v(" "),v("p",[t._v("所谓蓝绿部署，是指同时运行两个版本的应用，如上图所示，蓝绿部署的时候，并不停止掉老版本，而是直接部署一套新版本，等新版本运行起来后，再将流量切换到新版本上。但是蓝绿部署要求在升级过程中，同时运行两套程序，对硬件的要求就是日常所需的二倍，比如日常运行时，需要10台服务器支撑业务，那么使用蓝绿部署，你就需要购置二十台服务器。")]),t._v(" "),v("p",[t._v("## 滚动发布")]),t._v(" "),v("p",[t._v("滚动发布能够解决掉蓝绿部署时对硬件要求增倍的问题。\n"),v("img",{attrs:{src:"https://img-blog.csdn.net/20180822160130273?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20zNzEwNDc2MjM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70",alt:"img"}})]),t._v(" "),v("p",[t._v("所谓滚动升级，就是在升级过程中，并不一下子启动所有新版本，是先启动一台新版本，再停止一台老版本，然后再启动一台新版本，再停止一台老版本，直到升级完成，这样的话，如果日常需要10台服务器，那么升级过程中也就只需要11台就行了。")]),t._v(" "),v("p",[t._v("但是滚动升级有一个问题，在开始滚动升级后，流量会直接流向已经启动起来的新版本，但是这个时候，新版本是不一定可用的，比如需要进一步的测试才能确认。那么在滚动升级期间，整个系统就处于非常不稳定的状态，如果发现了问题，也比较难以确定是新版本还是老版本造成的问题。")]),t._v(" "),v("p",[t._v("为了解决这个问题，我们需要为滚动升级实现流量控制能力。")]),t._v(" "),v("p",[t._v("## 灰度发布")]),t._v(" "),v("p",[t._v("灰度发布也叫金丝雀发布，起源是，矿井工人发现，金丝雀对瓦斯气体很敏感，矿工会在下井之前，先放一只金丝雀到井中，如果金丝雀不叫了，就代表瓦斯浓度高。\n"),v("img",{attrs:{src:"https://img-blog.csdn.net/20180822160153895?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20zNzEwNDc2MjM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70",alt:"img"}})]),t._v(" "),v("p",[t._v("在灰度发布开始后，先启动一个新版本应用，但是并不直接将流量切过来，而是测试人员对新版本进行线上测试，启动的这个新版本应用，就是我们的金丝雀。如果没有问题，那么可以将少量的用户流量导入到新版本上，然后再对新版本做运行状态观察，收集各种运行时数据，如果此时对新旧版本做各种数据对比，就是所谓的A/B测试。")]),t._v(" "),v("p",[t._v("当确认新版本运行良好后，再逐步将更多的流量导入到新版本上，在此期间，还可以不断地调整新旧两个版本的运行的服务器副本数量，以使得新版本能够承受越来越大的流量压力。直到将100%的流量都切换到新版本上，最后关闭剩下的老版本服务，完成灰度发布。")]),t._v(" "),v("p",[t._v("如果在灰度发布过程中（灰度期）发现了新版本有问题，就应该立即将流量切回老版本上，这样，就会将负面影响控制在最小范围内。")]),t._v(" "),v("p",[t._v("## 使用脉冲云轻松地实现灰度发布")]),t._v(" "),v("p",[t._v("脉冲云的部署管理可以轻松实现上述的带有流量管理功能的灰度发布。正常编辑应用信息后点击保存，然后脉冲云会提示直接升级或灰度发布。\n"),v("img",{attrs:{src:"https://img-blog.csdn.net/20180822160214367?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20zNzEwNDc2MjM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70",alt:"img"}})]),t._v(" "),v("p",[t._v("直接升级就是使用一般的滚动升级，点击灰度发布后可以人工干预升级过程，进行流量控制。")]),t._v(" "),v("p",[t._v("选择灰度发布后，就会呈现灰度发布控制面板。\n"),v("img",{attrs:{src:"https://img-blog.csdn.net/2018082216023970?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20zNzEwNDc2MjM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70",alt:"img"}})]),t._v(" "),v("p",[t._v("在这个控制面板上，可以拖拉滑块，快速调整新旧版本的运行副本数量，同时也可以按百分比，将流量导入到新版本上。此外，还可以通过匹配HTTP Header，指定个别用户的流量到新版本上。\n"),v("img",{attrs:{src:"https://img-blog.csdn.net/20180822173340801?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20zNzEwNDc2MjM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70",alt:"img"}})]),t._v(" "),v("p",[t._v("除了匹配用户流量的HTTP请求头，还可以直接指定匹配请求头中的Cookie信息，匹配规则支持精确匹配、包含、正则、前缀、后缀等，甚至还允许反向匹配。")]),t._v(" "),v("p",[t._v("当确认新版本运行无误后，就可以点击 "),v("strong",[t._v("完成升级")]),t._v(" 按钮，就会将流量全部切换到新版本上，并且销毁掉所有老版本应用。如果新版本出了问题，可以点击 取消升级 按钮，立即将流量切回老版本，并销毁掉新版本应用。\n"),v("img",{attrs:{src:"https://img-blog.csdn.net/20180822160311392?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20zNzEwNDc2MjM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70",alt:"img"}})]),t._v(" "),v("p",[t._v("## 总结")]),t._v(" "),v("p",[t._v("在新版本应用发布时，为了服务器不停机升级，使用灰度发布策略，在灰度发布开始时，使用HTTP Header 匹配指定测试人员的流量到新版本上，然后当新版本内部测试通过后，可以再按百分比，将用户流量一点一点导入到新版本中，比如先导入10%观察一下运行情况，然后再导入20%，如此累加，直到将流量全部导入到新版本上，最后完成升级，如果期间发现问题，就立即取消升级，将流量切回到老版本。")]),t._v(" "),v("p",[t._v("运用灰度发布，就再也不需要加班到深夜进行停机升级了，在白天就可以放心大胆地、安全地发布新版本。")]),t._v(" "),v("p",[v("strong",[t._v("相关资料：")])]),t._v(" "),v("p",[t._v("脉冲云："),v("a",{attrs:{href:"https://maichong.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("脉冲云"),v("OutboundLink")],1)]),t._v(" "),v("p",[t._v("灰度发布视频：\nhttps://v.youku.com/v_show/id_XMzc4OTU3OTA3Mg==.html?spm=a2h3j.8428770.3416059.1")])])}),[],!1,null,null,null);s.default=e.exports}}]);