---
title: 卓越寒假调查_H5
date: 2021-07-07 21:59:22
permalink: /pages/4669df/
categories:
  - 运维
  - 项目部署
tags:
  - 
---

## 卓越寒假调查 H5

#### 1、 部署路径相关 路径和简介 
>   部署服务器:  **斌的服务器**
>   服务器域名:  www.alicbin.com 
>   IP:  81.71.70.123
>   项目所在路径 ： /home/java/zhuoyue_api   
>       ./api   后台接口服务
>  	./page  所 h5 页面
>  	./certs ssl 证书 
>   nginx 配置文件： /www/server/panel/vhost/nginx/zhouyue.youxiniao.net.conf  （详情请看下面） 

#### 2、创建 docker 容器 跑 后台 api 服务 

###### 1、设计容器的端口  和 容器名 挂载点等的信息
```code
	2.tomcat 容器创建   接口服务器
	容器名  --name zhuoyue_api
	容器一直启动  --restart always
	端口 18082:8080/tcp 	(注意记得 开启该端口的 安全组或防火墙)	         
	挂载点
		/home/java/zhuoyue_api/api:/usr/local/tomcat/webapps/api  
		/home/java/zhuoyue_api/conf:/usr/local/tomcat/conf
		/home/java/zhuoyue_api/logs/tomcat:/usr/local/tomcat/logs 
		/home/java/zhuoyue_api/app_logs:/opt/logs/app_logs	  
	使用镜像
		tomcat:8.5.12-jre8  (自行 先拉取镜像  docker pull tomcat:8.5.12-jre8  ) 
	命令： catalina.sh run
```
###### 2、在服务器终端执行命令 

​    如下:这因为有换行所以 **不可以直接运行**

```shell
	docker run 
	--restart always 
	--name zhuoyue_api 
	-p 18082:8080/tcp 
    -v /home/java/zhuoyue_api/api:/usr/local/tomcat/webapps/api
    -v /home/java/zhuoyue_api/conf/:/usr/local/tomcat/conf/
    -v /home/java/zhuoyue_api/logs/tomcat:/usr/local/tomcat/logs 
    -v /home/java/zhuoyue_api/app_logs:/opt/logs/app_logs    
    -it
    -d tomcat:8.5.12-jre8 catalina.sh run
```
​	 直接运行 去掉换行   **可以直接运行**
```shell
docker run --restart always --name zhuoyue_api -p 18082:8080/tcp -v /home/java/zhuoyue_api/api:/usr/local/tomcat/webapps/api -v /home/java/zhuoyue_api/conf/:/usr/local/tomcat/conf/ -v /home/java/zhuoyue_api/logs/tomcat:/usr/local/tomcat/logs  -v /home/java/zhuoyue_api/app_logs:/opt/logs/app_logs -it -d tomcat:8.5.12-jre8 catalina.sh run
```

```
docker run --restart always --name pet_api -p 18080:8080/tcp -v /home/java/api:/usr/local/tomcat/webapps/api -it -d tomcat:8.5.12-jre8 catalina.sh run
```



创建成功会返回  容器 id

###### 3.查看是否创建成功  
```shell
docker ps
```
显示列表中有 刚才创建的 容器名列表 则创建创建 ok

#### 3、nginx 相关配置  zhouyue.youxiniao.net.conf
```nginx
#上游服务器 用来跳转
upstream zhuoyue.youxiniao.net{
    server  zhuoyue.youxiniao.net:18082;
}


    server {
		listen 80; #监听http的80端口
		server_name zhuoyue.youxiniao.net;  # 这是我们设置的域名
		#access_log  logs/frp.alicbin.log  main; # 记录日志
		 access_log  /www/wwwlogs/zhuoyue.youxiniao.net.log;# 记录日志

        rewrite  ^(.*)    https://zhuoyue.youxiniao.net permanent; # 强跳转 https  后下面的代码其实 已经不执行了

		location / {
			    # 正常上网
			   	 index index.php index.html index.htm default.php default.htm default.html;
			      root /home/java/zhuoyue_api/page;

  				# frp 内网穿透
				# proxy_pass http://127.0.0.1:10021;#7004 # 转发到我们在frps.ini中设置的vhost_http_port端口
				# proxy_set_header    Host   $host:80;  #不添加这行时访问需要 域名:7001才能访问到内网的机器，如果加了就不再需要后面的端口，直接使用域名访问
				# proxy_set_header    X-Real-IP       $remote_addr;
				# proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
				# proxy_hide_header   X-Powered-By;
		}
		
         #接口 
         location /api{ 
         proxy_pass    http://zhuoyue.youxiniao.net;  #直接
         proxy_set_header   Cookie $http_cookie;
         # proxy_set_header X-Real-IP $remote_addr;
         proxy_set_header Host $proxy_host;
         }
		
		
	}

	  
    server {
		listen 443; 
		server_name zhuoyue.youxiniao.net;  # 这是我们设置的域名
		access_log  /www/wwwlogs/zhuoyue.youxiniao.net.log;# 记录日志
		ssl on;
		ssl_certificate  /home/java/zhuoyue_api/certs/2021_zhuoyue.youxiniao.net.pem;
		ssl_certificate_key  /home/java/zhuoyue_api/certs/2021_zhuoyue.youxiniao.net.key;
		ssl_session_timeout 10m;
		ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
		ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
		ssl_prefer_server_ciphers on;

		location / {
			index index.php index.html index.htm default.php default.htm default.html;
			root /home/java/zhuoyue_api/page;
		}
		 #接口
         location /api{
         proxy_pass    http://zhuoyue.youxiniao.net;
         proxy_set_header   Cookie $http_cookie;
         # proxy_set_header X-Real-IP $remote_addr;
         proxy_set_header Host $proxy_host;
         }
		
		
	}

```

> ##### 作者：@洪斌 http://blogs.alicbin.com



